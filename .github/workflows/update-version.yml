name: Update Version in HTML

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  update-version:
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
        with:
          ref: main
          fetch-depth: 0

      - name: Extract version from tag
        id: version
        run: |
          TAG_NAME=${GITHUB_REF#refs/tags/}
          echo "tag=$TAG_NAME" >> $GITHUB_OUTPUT
          echo "Version from tag: $TAG_NAME"

      - name: Update version in HTML
        run: |
          TAG_NAME=${{ steps.version.outputs.tag }}

          # Update APP_VERSION in docs/index.html
          sed -i "s/const APP_VERSION = 'v[0-9]*\.[0-9]*\.[0-9]*';/const APP_VERSION = '$TAG_NAME';/" docs/index.html

          # Verify the change
          grep "const APP_VERSION" docs/index.html

      - name: Commit version update
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          git add docs/index.html

          # Only commit if there are changes
          if git diff --staged --quiet; then
            echo "No version changes to commit"
          else
            git commit -m "chore: update web version to ${{ steps.version.outputs.tag }} [skip ci]"
            git push origin main
            echo "Version updated successfully!"
          fi
